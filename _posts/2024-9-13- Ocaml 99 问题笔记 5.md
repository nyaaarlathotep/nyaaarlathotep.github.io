---
layout: post
title: OCaml 99 问题笔记（Multiway Trees 部分）
date:  2024-9-13 9:00:00 +0900
description: 学了点 FP，趁热打铁，试试 OCaml 和他的这些函数式问题。
categories: [FP, OCaml]
keywords: OCaml
essays: true   
---

# 笔记

### 62. Tree Construction From a Node String

> ![Multiway Tree](https://ocaml.org/media/problems/multiway-tree.gif)
>
> *A multiway tree is composed of a root element and a (possibly empty) set of successors which are multiway trees themselves. A multiway tree is never empty. The set of successor trees is sometimes called a forest.*
>
> To represent multiway trees, we will use the following type which is a direct translation of the definition:
>
> ```
> # type 'a mult_tree = T of 'a * 'a mult_tree list;;
> type 'a mult_tree = T of 'a * 'a mult_tree list
> ```
>
> The example tree depicted opposite is therefore represented by the following OCaml expression:
>
> ```
> # T ('a', [T ('f', [T ('g', [])]); T ('c', []); T ('b', [T ('d', []); T ('e', [])])]);;
> - : char mult_tree =
> T ('a',
>  [T ('f', [T ('g', [])]); T ('c', []); T ('b', [T ('d', []); T ('e', [])])])
> ```
>
> We suppose that the nodes of a multiway tree contain single characters. In the depth-first order sequence of its nodes, a special character `^` has been inserted whenever, during the tree traversal, the move is a backtrack to the previous level.
>
> By this rule, the tree in the figure opposite is represented as: `afg^^c^bd^e^^^`.
>
> Write functions `string_of_tree : char mult_tree -> string` to construct the string representing the tree and `tree_of_string : string -> char mult_tree` to construct the tree when the string is given.
>
> ```
> # let t = T ('a', [T ('f', [T ('g', [])]); T ('c', []);
>           T ('b', [T ('d', []); T ('e', [])])]);;
> val t : char mult_tree =
>   T ('a',
>    [T ('f', [T ('g', [])]); T ('c', []); T ('b', [T ('d', []); T ('e', [])])])
> ```

来了来了。巧妙的是它是用一个多余 ^ 来表明自己的结束的，就像是自己的根上层还有父一样，正好符合递归了。

```
let rec string_of_tree root = 
	let rec string_of_l l = match l with
		| [] -> ""
		| h::t -> string_of_tree h ^ (string_of_l t)
	in
	match root with
		| T (v, sons) -> String.make 1 v ^ string_of_l sons ^ "^"
```

这个递归有点麻烦哦。呃呃呃，好像没法搞了，我这两个内部函数互相调用，但 OCaml 又不是那种申明式的，编译都无法通过吧？

完了啊，噶了，这个递归这么麻烦，我写了这么久。这下寄了。

癌，有了有了，查了下文档发现可以用 and 这样写。以前的标准答案也用过啊，傻了。

```
let rec tree_of_string s =
	let eat_one str = Str.string_after str 1 in
	let rec aux remain = let (sonss, remain1) = sons (eat_one remain) in
		(T(remain.[0], sonss), remain1)
	and
	sons remain = if remain.[0]='^' then ([], eat_one remain) else
		let (bro, remain1)=aux remain in
		let (other_bros, remain2) = sons remain1 in
		(bro::other_bros, remain2)
	in
	aux s
	
    	
```

咋回事呢，你把你 tree_of_string 给我交了。

又用个 buff 是吧。

> ```
> # (* We could build the final string by string concatenation but
>      this is expensive due to the number of operations.  We use a
>      buffer instead. *)
>   let rec add_string_of_tree buf (T (c, sub)) =
>     Buffer.add_char buf c;
>     List.iter (add_string_of_tree buf) sub;
>     Buffer.add_char buf '^'
>   let string_of_tree t =
>     let buf = Buffer.create 128 in
>     add_string_of_tree buf t;
>     Buffer.contents buf;;
> val add_string_of_tree : Buffer.t -> char mult_tree -> unit = <fun>
> val string_of_tree : char mult_tree -> string = <fun>
> ```

### 63. Count the Nodes of a Multiway Tree

> ```
> # count_nodes (T ('a', [T ('f', []) ]));;
> - : int = 2
> ```

泪目了，简单的来了，和回家了一样安心。

我发现多叉树的总是要有这种复合互相调用的递归，神秘哦。

```
let rec count_nodes (T(v, sons)) = 
	let rec aux l = match l with
		| [] -> 0
		| h::t -> count_nodes h + aux t
	in
	1 + aux sons
```

还得是你啊，fold_left，学，好吧，学。

> ```
> # let rec count_nodes (T (_, sub)) =
>     List.fold_left (fun n t -> n + count_nodes t) 1 sub;;
> val count_nodes : 'a mult_tree -> int = <fun>
> ```

### 64. Determine the Internal Path Length of a Tree

> We define the internal path length of a multiway tree as the total sum of the path lengths from the root to all nodes of the tree. By this definition, the tree `t` in the figure of the previous problem has an internal path length of 9. Write a function `ipl tree` that returns the internal path length of `tree`.
>
> ```
> # ipl t;;
> - : int = 9
> ```



# 总结

